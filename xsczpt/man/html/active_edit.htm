<!DOCTYPE HTML>
<html>
<head>
<title>{name}-{gtitle}</title>
{cssjs}     
<script language="javascript" type="text/javascript" src="/widget/datepicker/WdatePicker.js"></script> 
<link href="/widget/umeditor/themes/default/css/umeditor.css" type="text/css" rel="stylesheet"> 
<script type="text/javascript" charset="gbk" src="/widget/umeditor/umeditor.config.js"></script>
<script type="text/javascript" charset="gbk" src="/widget/umeditor/umeditor.min.js"></script>
<script type="text/javascript" src="/widget/umeditor/lang/zh-cn/zh-cn.js"></script>  
<script type="text/javascript" src="/widget/datepicker/WdatePicker.js"></script>



</head>
<body> 
{top}
<div class="container">

<div class="col-sm-3">   
{menu}
</div>

<div class="page-header">
   <h3>活动编辑<small>【修改】</small></h3>
</div>
<div class="col-sm-9">   
<form role="form"  class="form-horizontal" id="form1">
<div class="form-group">
  <label class="col-sm-2 control-label">活动名称</label>
  <div class="col-sm-6"><input type="text" class="form-control" id="name" placeholder="请输入名字"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">类型/级别</label>
  <div class="col-sm-3"><select id="cid" class="form-control"></select></div>
  <div class="col-sm-3"><select id="lvl" class="form-control"></select></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">年级/学科</label>
  <div class="col-sm-4"><select id="grade" class="form-control"></select>
  <p class="help-block" id="gradet"></p><a onclick="clearFX('#grade')">清空</a></div>
  <div class="col-sm-4"><select id="subject" class="form-control"></select>
  <p class="help-block" id="subjectt"></p><a onclick="clearFX('#subject')">清空</a></div>
</div>

<div class="form-group">
  <label class="col-sm-2 control-label">报名时间</label>
  <div class="col-sm-3"><input type="text" id="rstime" class="form-control" placeholder="报名开始时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
  <div class="col-sm-3"><input type="text" id="retime" class="form-control" placeholder="报名结束时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动时间</label>
  <div class="col-sm-3"><input type="text" id="stime" class="form-control" placeholder="活动开始时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
  <div class="col-sm-3"><input type="text" id="etime" class="form-control" placeholder="活动结束时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动地址</label>
  <div class="col-sm-8"><input type="text" class="form-control" id="addrs" placeholder="活动地址"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">联系方式</label>
  <div class="col-sm-8"><input type="text" class="form-control" id="contacts" placeholder="电话，邮箱，微信……"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动介绍</label>
  <div class="col-sm-10">
    <textarea id="des" name="des" data-edit="um" style="display:none;"></textarea>
  <script type="text/plain" id="umdes" style="width:100%;height:250px;"></script>
</div>
</div>

<hr/>
<div class="form-group">
  <label class="col-sm-2 control-label">活动人数</label>
  <div class="col-sm-3"><input type="text" class="form-control" id="maxnum" placeholder="活动最大人数" onkeyup="value=value.replace(/[^0-9/]/ig,'')"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">访问权限</label>
  <div class="col-sm-3"><select id="visit" class="form-control"><option value="0">公开，所有可以访问</option>
  <option value="1">登录，需要登录用户</option><option value="2">指定人，仅限指定的用户才可访问</option>
  <option value="3">秘密活动，参与活动可见</option>  </select></div> 
</div>         
<div class="form-group">
  <label class="col-sm-2 control-label">活动报名</label>
  <div class="col-sm-3"><select id="enroll" class="form-control"><option value="0">公开报名</option>
  <option value="1">报名需审核</option><option value="2">仅限邀请</option></select></div> 
</div>  
 

 
      <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
      <input id="period" type="text" value="" style="display:none;"/>
      <input id="addr" type="text" value="" style="display:none;"/> 
      <input id="school" type="text"  value="0" style="display:none;"/>
      <input id="state" type="text" value="0" style="display:none;"/>
       <input id="status" type="text" value="0" style="display:none;"/>
      <input id="grades" type="text" value="" style="display:none;"/>
      <input id="subjects" type="text"  value="" style="display:none;"/>   
       <input id="id" type="text" style="display:none;"/>    
       
         <button type="button" class="btn btn-primary" id="btn">确定保存</button>
      </div>
   </div>
</form>

 
</div>
  
<div class="col-sm-3">
<div class="text-center">
 
</div>
<hr/>
 
 
</div>
  
  
</div>
   
{foot}
</body>
</html>
<script>
var um = UM.getEditor('umdes'); 
var l_tpl="activity";
$(function() { 
  $.get("/data/active_cate.txt", function (d) {$("#cid").append(d);}); 
  $.get("/data/active_lvl.txt", function (d) {$("#lvl").append(d);}); 
  $.get("/data/grade_n1.txt", function (data) {selectAddHead("#grade","年级");$("#grade").append(data);});
  $.get("/data/subject.txt", function (data) {selectAddHead("#subject","学科");$("#subject").append(data);}); 
  $("#btn").bind("click",function(){
      SaveAM({"do":queryStr("d"),id:queryStr("id"),frmid:"#form1",showok:"",callback:"doendrun"});
   });  
   if(queryStr("d")=="m"){
      readID({"do":"r",id:queryStr("id"),frmid:"#form1",callback:"readcallback"});  
    }  
  $("#grade").bind("change",function(){if($(this).val()=="")return;
       $("#gradet").append(","+$(this).find(":selected").text());
       if($("#grades").val()=="")$("#grades").val($(this).val());else $("#grades").val($("#grades").val()+","+$(this).val());
    });  
    $("#subject").bind("click",function(){if($(this).val()=="")return;
       $("#subjectt").append(","+$(this).find(":selected").text());   
       if($("#subjects").val()=="")$("#subjects").val($(this).val());
       else $("#subjects").val($("#subjects").val()+","+$(this).val());
    });   
 }); 
function readcallback(e,d){  
  //if($("#addr").val()!="")$("#addrv").val(jsonAddr[$("#addr").val()]);
 // if($("#school").val()!="")
  //  $.post("./srv/rdo.php?", {"tpl":"get_sch_s","id":$("#school").val()}, function (d, e) {                  
   //      $("#schoolv").val($.trim(d));    
    //  });    
} 	

function doendrun(ed,data){      alert(data);
   if(data.indexOf('ok')>-1){     
     // rid=data.substr(data.indexOf('ok')+2); 
      //location.href="./?t=active_push1&id="+rid;
   }
   else
      alert(data);
}
function clearFX(ctr){
   $(ctr+"t").html("");
   $(ctr+"s").val("");
}
 
</script>