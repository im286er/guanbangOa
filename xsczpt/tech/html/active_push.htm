<!DOCTYPE HTML>
<html>
<head>
<title>发布活动-{gtitle}</title>
{cssjs}  
<script src="js/activec.js" type="text/javascript"></script> 
<script type="text/javascript" charset="gbk"  src="/widget/ueditor/ueditor.config.js"></script>
<script type="text/javascript" charset="gbk"  src="/widget/ueditor/ueditor.all.min.js"> </script>
<script type="text/javascript" charset="gbk"  src="/widget/ueditor/lang/zh-cn/zh-cn.js"></script>  
<!--
<script type="text/javascript" src="http://api.map.baidu.com/api?ak=XckXd2Kf8TmdTCZDysgmuqzx&v=2.0&services=true"></script>
-->
</head>
<body> 
{top}
<div class="container">
{head}   
<div class="col-sm-12">
   <h3>发起活动<small>子标题</small></h3>
</div>


<div class="col-sm-9">     
<hr/>
<form role="form"  class="form-horizontal" id="form1">
<div class="form-group">
  <label class="col-sm-2 control-label">活动名称</label>
  <div class="col-sm-6"><input type="text" class="form-control" id="name" placeholder="请输入名字"></div>
</div>
<div class="form-group" id="div_1">
  <label class="col-sm-2 control-label">活动单位</label>
  <div class="col-sm-3"><select id="school" class="form-control"><option value="0">教育局</option></select>
  <p class="help-block">*活动单位为必选项,选择后禁止修改</p></div> 
  <label class="col-sm-1 control-label">级别</label> 
  <div class="col-sm-2"><select id="lvl" class="form-control"></select></div>
    <label class="col-sm-1 control-label">类型</label>
  <div class="col-sm-2"><select id="cid" class="form-control"></select></div>
</div>
<div class="form-group"  id="div_2">
   <label class="col-sm-2 control-label">学段</label>
  <div class="col-sm-3"><select id="period" class="form-control"></select>       
  <p class="help-block" id="periodt"></p><a onclick="clearFX('#period')">清空</a></div>
  <label class="col-sm-1 control-label">年级</label>
  <div class="col-sm-3"><select id="grade" class="form-control"></select>
  <p class="help-block" id="gradet"></p><a onclick="clearFX('#grade')">清空</a></div>
</div>
<div class="form-group"  id="div_3">
 <label class="col-sm-2 control-label">学科</label>
  <div class="col-sm-3"><select id="subject" class="form-control"></select>
  <p class="help-block" id="subjectt"></p><a onclick="clearFX('#subject')">清空</a></div>
</div>

<div class="form-group">
  <label class="col-sm-2 control-label">报名时间</label>
  <div class="col-sm-3"><input type="text" id="rstime" class="form-control" placeholder="报名开始时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
  <div class="col-sm-3"><input type="text" id="retime" class="form-control" placeholder="报名结束时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动时间</label>
  <div class="col-sm-3"><input type="text" id="stime" class="form-control" placeholder="活动开始时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
  <div class="col-sm-3"><input type="text" id="etime" class="form-control" placeholder="活动结束时间"  onfocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm',isShowClear:false,readOnly:true})" readonly/></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动地址</label>
  <div class="col-sm-8"><input type="text" class="form-control" id="addrs" placeholder="活动地址"></div>
  <div class="col-sm-2"><button type="button" class="btn btn-success" id="btnmap">地图定位</button></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">联系方式</label>
  <div class="col-sm-8"><input type="text" class="form-control" id="contacts" placeholder="电话，邮箱，微信……"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">活动介绍</label>
  <div class="col-sm-10">
<textarea id="des" name="des" data-edit="ue" style="display:none;"></textarea>
<script type="text/plain" id="uedes" style="width:100%;height:400px;"></script>
</div>
</div>

<hr/>
<div class="form-group">
  <label class="col-sm-2 control-label">活动人数</label>
  <div class="col-sm-3"><input type="text" class="form-control" id="maxnum" placeholder="活动最大人数" onkeyup="value=value.replace(/[^0-9/]/ig,'')"></div>
</div>
<div class="form-group">
  <label class="col-sm-2 control-label">访问权限</label>
  <div class="col-sm-3"><select id="visit" class="form-control"><option value="0">公开，所有可以访问</option>
  <option value="1">登录，需要登录用户</option><option value="2">指定人，仅限指定的用户才可访问</option>
  <option value="3">秘密活动，参与活动可见</option>  </select></div> 
</div>         
<div class="form-group">
  <label class="col-sm-2 control-label">活动报名</label>
  <div class="col-sm-3"><select id="enroll" class="form-control"><option value="0">公开报名</option>
  <option value="1">报名需审核</option><option value="2">仅限邀请</option></select></div> 
</div>  
 

 
      <div class="form-group">
      <div class="col-sm-offset-2 col-sm-10">
      <input id="period" type="text" style="display:none;"/>
      <input id="addr" type="text" style="display:none;"/> 
      <input id="school" type="text"  value="0" style="display:none;"/>
      <input id="state" type="text" value="0" style="display:none;"/>
      <input id="status" type="text" value="0" style="display:none;"/>
      <input id="periods" type="text" style="display:none;"/>
      <input id="grades" type="text" style="display:none;"/>
      <input id="subjects" type="text" style="display:none;"/>   
      <input id="id" type="text" style="display:none;"/>    
         <button type="button" class="btn btn-primary" id="btn">立即发布</button>
      </div>
   </div>
</form>

 
</div>
  
</div>
   
{foot}
</body>
</html>
<div class="modal" id="dlg1" tabindex="-1" role="dialog"    aria-labelledby="myModalLabel" aria-hidden="true">
<div class="modal-dialog" style="width:550px;height:400px;"><div class="modal-content"><div class="modal-header"> <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
<h4 class="modal-title" id="label">地图定位<small></small></h4></div>
<div class="modal-body">
 <div id='bdmap'  style="width:100%;height:350px;display:none;">
 
  </div>
</div>
<div class="modal-footer">
<button type="button" class="btn btn-default" data-dismiss="modal">完成</button></div></div></div></div>  

<script>
var ue = UE.getEditor('uedes');  
UE.Editor.prototype._bkGetActionUrl = UE.Editor.prototype.getActionUrl;
UE.Editor.prototype.getActionUrl = function(action) {            
    if (action == 'uploadimage' || action == 'uploadscrawl' || action == 'uploadimage') {
        return '/tech/updb/imageUp.php';
    }else if (action == 'uploadvideo') {
        return '/tech/updb/videoUp.php';
    }
    else  if(action == 'uploadfile'){
       return '/tech/updb/docUp.php'
    }else {
        return this._bkGetActionUrl.call(this, action);
    } 
}
ue.addListener("ready", function () {   
    if(queryStr("d")=="m") readID({"do":"r",id:queryStr("id"),frmid:"#form1"}); 
});
var l_tpl="activity";
var dotype="a";
$(function() { 
  if(queryStr("d")=="m"){
    dotype="m";
    $("#div_1").addClass("hide");
    $("#div_2").addClass("hide");
    $("#div_3").addClass("hide");
    
  }
  $.get("/data?t=active_level&f=txt",function(d){$("#lvl").html(d);}); 
  $.get("/data?t=active_category&f=txt",function(d){ $("#cid").html(d);}); 
  $.get("/data?t=sys_period&f=txt",function(d){ selectAddHead("#period","学段");$("#period").append(d);});       
  $.get("/data?t=sys_grade&f=txt", function (d) {selectAddHead("#grade","年级");$("#grade").append(d);});
  $.get("/data?t=sys_subject&f=txt", function (data) {selectAddHead("#subject","学科");$("#subject").append(data);}); 
  $.post("./srv/rdo.php", {tpl:"get_sch"}, function (d, e) {                     
      t=JSON.parse(d);
      for(k=0;k<t.length;k++)
          $("#school").append("<option value="+t[k].id+">"+t[k].name+"</option>");           
  });  
   
  $("#btn").bind("click",function(){
      SaveAM({"do":dotype,frmid:"#form1",showok:"",callback:"doendrun"});
    });
      
  $("#period").bind("change",function(){if($(this).val()=="")return;
       if($("#periodt").text()!="")$("#periodt").append(",");
       $("#periodt").append($(this).find(":selected").text());
       v=$(this).val();
       if($("#periods").val()=="")$("#periods").val(v);else $("#periods").val($("#periods").val()+","+$(this).val());
       $.get("/data?t=sys_grade&f=txt&pn=period&pv="+v, function (d) {selectAddHead("#grade","年级");$("#grade").append(d);});
       $.get("/data/subject.php?s="+$("#school").val()+"&f=txt&pn=period&pv="+v, function (data) {
          selectAddHead("#subject","学科");$("#subject").append(data);
       }); 
  });     
  $("#grade").bind("change",function(){if($(this).val()=="")return;
       if($("#gradet").text()!="")$("#gradet").append(",");
       $("#gradet").append($(this).find(":selected").text());
       if($("#grades").val()=="")$("#grades").val($(this).val());else $("#grades").val($("#grades").val()+","+$(this).val());
    });  
    $("#subject").bind("change",function(){if($(this).val()=="")return;
        if($("#subjectt").text()!="")$("#subjectt").append(",");
       $("#subjectt").append($(this).find(":selected").text());   
       if($("#subjects").val()=="")$("#subjects").val($(this).val());
       else $("#subjects").val($("#subjects").val()+","+$(this).val());
    }); 
   $("#btnmap").bind("click",function(){
       $('#dlg1').modal('show'); 
       $("#bdmap").css("display","block");
    });     
 }); 

function doendrun(ed,data){ 
   if(data.indexOf('ok')>-1){     
      rid=data.substr(data.indexOf('ok')+2);        
      if(dotype=="m") 
        location.href="?t=active_push1&id="+queryStr("id");
      else  
        location.href="?t=active_push1&id="+rid;
   }
   else
      lalert(data);
}
function clearFX(ctr){
   $(ctr+"t").html("");
   $(ctr+"s").val("");
}

/**baidu map position  
var map = new BMap.Map("bdmap");
var tmp5 = new BMap.Geolocation();
tmp5.getCurrentPosition(function(res){
      if(this.getStatus() == BMAP_STATUS_SUCCESS){	
          map.centerAndZoom(res.point,15);
          //window.alert(res.point.lng + " " + res.point.lat);
          marker = new BMap.Marker(res.point);
          map.addOverlay(marker);
          map.panTo(res.point);
      }
});

map.addControl(new BMap.NavigationControl());   // 默认左上方,
map.addControl(new BMap.OverviewMapControl());  // 默认右下方，缩略

map.addEventListener("click",function(e){
  if(marker == ""){
  	marker = new BMap.Marker(e.point);
  	map.addOverlay(marker);
  }else{
  	map.removeOverlay(marker);
  	marker = new BMap.Marker(e.point);
  	map.addOverlay(marker);
  }
});

map.addEventListener("dblclick",function(e){
    var geo = new BMap.Geocoder();
    geo.getLocation(e.point,function(result){
    if(result){
        //id3.innerText = result.address;
        $("#addrs").val(result.address);
        $("#dlg1 .modal-title small").text(result.address);
    }	
    id1.style.display="none";
    });
}); 
       */ 
</script>