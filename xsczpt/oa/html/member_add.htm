<!DOCTYPE HTML>
<html>
<head>
<title>{gtitle}</title>   
<link rel="stylesheet" href="css/oa_index.css" type="text/css" /> 
<link rel="stylesheet" href="css/home.css"  type="text/css"/>
<link rel="stylesheet" href="/widget/bootstrap/css/bootstrap.min.css">  
<script src="js/oa_index.js" type="text/javascript"></script>
<script src="js/bskdlg.js" type="text/javascript"></script>
<script type="text/javascript" language="javascript" src="common/jquery.js"></script>
<script src="/ppf/js/frtdo.js" type="text/javascript"></script> 
<script src="/ppf/js/jquery.base64.js" type="text/javascript"></script>
<script src="/ppf/js/fun.js" type="text/javascript"></script>  
<script src="/ppf/js/select.js"></script> 
<link href="css/css.css" rel="stylesheet" type="text/css" /> 
<script language="javascript" src="common/autocomplete.js"></script>
<link href="common/autocomplete.css" rel="stylesheet" type="text/css" /> 
<script language="javascript" src="common/autocomplete.js"></script>
<link href="common/autocomplete.css" rel="stylesheet" type="text/css" />  
<script type="text/javascript" language="javascript" src="common/ajaxfileupload.js"></script> 
<script type="text/javascript" src="common/DatePicker/WdatePicker.js"></script>
<script type="text/javascript" language="javascript" src="common/common.js"></script>

</head>
<body>
<div class="main">
	<div class="box">
		<form action="./srv/member_add_submit.php" method="post" onsubmit="return checkForm();">
			<div class="boxtitle">
				<label class="current"><a href="javascript:void(0);" onclick="showDiv(this,'p1');">基本信息</a></label> 
				<label><a href="javascript:void(0);" onclick="showDiv(this,'p3');">联系人</a></label> 
				<label><a href="javascript:void(0);" onclick="showDiv(this,'p2');">中考信息</a></label> 
			</div>
			<div class="tabbody" id="p1">
				<table width="100%" border="0" class="tab" cellpadding="0" cellspacing="0">
					<tr>
						 <td width="20%" class="tabtd2_L">登录名</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="username" name="username" size="25" /> 18位身份证号码
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">密码</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="userpass" name="userpass" size="15" /> 默认为身份证后6位
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">家长密码</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="parent_pass" name="parent_pass" size="15" /> 默认为6个0
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">姓名</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="truename" name="truename" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">性别</td>
						 <td width="80%" class="tabtd2_R">
							<input type="radio" name="gender" value="男" checked="checked" /> 男
							<input type="radio" name="gender" value="女" /> 女
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">出生日期</td>
						 <td width="80%" class="tabtd2_R">
							<input name="birth_date" id="birth_date" type="text" readonly="readonly" onClick="WdatePicker({isShowClear:false,readOnly:true,skin:'whyGreen',lang:'zh-cn',dateFmt:'yyyy-MM-dd'});" class="Wdate" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">学号</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="person_no" name="person_no" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">所在班级</td>
						 <td width="80%" class="tabtd2_R">
							<select name="gid" id="gid" onchange="selectClass(this);">
								
							</select>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">民族</td>
						 <td width="80%" class="tabtd2_R">
							<select name="nation" id="nation">
								
							</select> 
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">政治面貌</td>
						 <td width="80%" class="tabtd2_R">
							<select name="political_status" id="political_status">
								
							</select> 
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">毕业学校</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="graduate_school" name="graduate_school" size="20" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">生源性质</td>
						 <td width="80%" class="tabtd2_R">
							<select name="from_type" id="from_type">
								
							</select>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">学籍状态</td>
						 <td width="80%" class="tabtd2_R">
							<select name="user_status" id="user_status">
								
							</select>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">既往病史</td>
						 <td width="80%" class="tabtd2_R">
							<textarea name="medical_history" id="medical_history" cols="60" rows="5"></textarea>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">联系电话</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="telphone" name="telphone" size="20" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">Email</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="email" name="email" size="20" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">QQ</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="qq" name="qq" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">地址</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="address" name="address" size="50" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">用户状态</td>
						 <td width="80%" class="tabtd2_R">
							<input type="radio" name="flag_status" value="1" checked="checked" /> 正常
							<input type="radio" name="flag_status" value="0" /> 停用
						  </td>
					</tr>
				</table>
			</div>
			<div class="tabbody" id="p2" style="display:none;">
				<table width="100%" border="0" class="tab" cellpadding="0" cellspacing="0">
					<tr>
						 <td width="20%" class="tabtd2_L">准考证号</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="exam_no" name="exam_no" size="25" /> 中考准考证号
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">语文成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="yw" name="yw" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">数学成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="sx" name="sx" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">外语成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="wy" name="wy" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">理化成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="lh" name="lh" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">政史成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="zs" name="zs" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">体育成绩</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" id="ty" name="ty" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">奖惩情况</td>
						 <td width="80%" class="tabtd2_R">
							<textarea name="intro" id="intro" cols="60" rows="5"></textarea>
						  </td>
					</tr>
				</table>
			</div>
			<div class="tabbody" id="p3" style="display:none;">
				<table width="100%" border="0" class="tab" cellpadding="0" cellspacing="0">
					<tr>
						 <td width="20%" class="tabtd2_L">&nbsp;</td>
						 <td width="80%" class="tabtd2_R">
							<a href="javascript:void(0);" onclick="addRelation();"><img src="images/add.gif" width="14" height="14" border="0" />&nbsp;增加</a>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">关系</td>
						 <td width="80%" class="tabtd2_R">
							<select name="relation[]">
								{str_code}
							</select>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">姓名</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="rel_name[]" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">工作单位</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="company[]" size="25" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">联系电话</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="phone[]" size="30" />
						  </td>
					</tr>
				</table>
				<table width="100%" border="0" class="tab" cellpadding="0" cellspacing="0">
					<tr>
						 <td width="20%" class="tabtd2_L">关系</td>
						 <td width="80%" class="tabtd2_R">
							<select name="relation[]">
								{str_code}
							</select>
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">姓名</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="rel_name[]" size="15" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">工作单位</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="company[]" size="25" />
						  </td>
					</tr>
					<tr>
						 <td width="20%" class="tabtd2_L">联系电话</td>
						 <td width="80%" class="tabtd2_R">
							<input type="text" name="phone[]" size="30" />
						  </td>
					</tr>
				</table>
			</div>
			<div class="boxfooter2">
				<input name="but_add" id="but_add" type="submit" value="添 加" style="background:url(images/butbg.gif) no-repeat top; width:75px; height:25px; border:0; cursor:hand;" />
				<input name="but_back" id="but_back" type="button" value="返 回" onclick="history.back();" style="margin-left:15px;background:url(images/butbg.gif) no-repeat top; width:75px; height:25px; border:0; cursor:hand;" /></div>
	</form>
	</div>
</div>
<div id="form_submit" style="display:none;">
	<table width="100%" border="0" class="tab" cellpadding="0" cellspacing="0">
		<tr>
			 <td width="20%" class="tabtd2_L">关系</td>
			 <td width="80%" class="tabtd2_R">
				<select name="relation[]">
					{str_code}
				</select>
			  </td>
		</tr>
		<tr>
			 <td width="20%" class="tabtd2_L">姓名</td>
			 <td width="80%" class="tabtd2_R">
				<input type="text" name="rel_name[]" size="15" />
			  </td>
		</tr>
		<tr>
			 <td width="20%" class="tabtd2_L">工作单位</td>
			 <td width="80%" class="tabtd2_R">
				<input type="text" name="company[]" size="25" />
			  </td>
		</tr>
		<tr>
			 <td width="20%" class="tabtd2_L">联系电话</td>
			 <td width="80%" class="tabtd2_R">
				<input type="text" name="phone[]" size="30" />&nbsp;&nbsp;<a href="javascript:void(0);" onclick="delRelation(this);"><img src="images/010.gif" width="9" height="9" border="0" />&nbsp;删除</a>
			  </td>
		</tr>
	</table>
</div>
{footer}      
</body>
</html> 
<script type="text/javascript">
$(function(){
	$.post("./srv/rdo.php?", {tpl:"get_grades",push_type:"4"}, function (d, e) {
		selectShowDataNoH("#gid",JSON.parse(d),"id","grade_name"); $("#gid").prepend("<option selected value='0'>请选择</option>");
	});
	
	$.post("./srv/rdo.php?", {tpl:"nation",push_type:"4"}, function (d, e) {
		selectShowDataNoH("#nation",JSON.parse(d),"code_name","code_name"); $("#nation").prepend("");
	});
	
	$.post("./srv/rdo.php?", {tpl:"from_type",push_type:"4"}, function (d, e) {
		selectShowDataNoH("#from_type",JSON.parse(d),"code_name","code_name"); $("#from_type").prepend("");
	});
	
	$.post("./srv/rdo.php?", {tpl:"user_status",push_type:"4"}, function (d, e) {
		selectShowDataNoH("#user_status",JSON.parse(d),"code_name","code_name"); $("#from_type").prepend("");
	});
	
	$.post("./srv/rdo.php?", {tpl:"political_status",push_type:"4"}, function (d, e) {
		selectShowDataNoH("#political_status",JSON.parse(d),"code_name","code_name"); $("#from_type").prepend("");
	});
});

//表单提交验证
function checkForm()
{
	if($.trim($("#username").val())==""){
		alert("登录名不能为空。");
		$("#username").select();
		return false;
	}
	if($.trim($("#truename").val())==""){
		alert("姓名不能为空。");
		$("#truename").select();
		return false;
	}
	if($("#cid").val()==undefined||$("#cid").val()==0){
		alert("请选择班级。");
		return false;
	}
	if($.trim($("#email").val())!=""){
		if(isEmail($("#email").val())==false){
			alert("请输入正确的Email地址");
			$("#email").select();
			return false;
		}	
	}

	//查询登录名是否已经存在
	$.post("./srv/sdo.php", {tpl:"check_vuser","username":$("#username").val().toUpperCase()}, function (d, e) {
		l=JSON.parse(d);
		if(l.flag=="true"){
			$("#but_add").attr("disabled","disabled");
			return l.flag;
		}else{
			alert(l.value);
			$("#username").select();
			$("#but_add").attr("disabled","disabled");
			return false;
		}
	});
}

//选择班级
function selectClass(obj)
{
	var val = $(obj).val();
	if(val>0){
		//查询是否有下级
		$.post("./srv/sdo.php?", {tpl:"select_class","grade_id":val}, function (d, e) {
			var d = eval('(' + d + ')');
			if(d.flag=="false"){
				alert(d.value);
			}else{
				//删除后面紧邻的下拉框
				$(obj).nextAll("select[id='cid']").remove();
				if(d.flag=="true"){
					var len = d.value.length;
					//动态生成下拉框
					var html;
					if(len>0){
						html = "<select name='cid' id='cid'>";
						html += "<option value='0'>请选择班级</option>";
						for(var i=0;i<len;i++){
							html +="<option value='"+d.value[i]["id"]+"'>"+d.value[i]["class_name"]+"</option>"
						}
						html += "</select>";
						$(obj).after(html);
					}
				}
			}
			$("#cid").val("{cid}");
		});
	}else{
		//删除后面紧邻的下拉框
		$(obj).nextAll("select[id='cid']").remove();
	}	
}

//增加联系人
function addRelation()
{
	var html = $("#form_submit").html();
	$("#p3").append(html);	
}
//删除联系人
function delRelation(obj)
{
	$(obj).parent().parent().parent().parent().remove();
}
</script> 